# 项目功能说明

## 核心功能

### 1. 用户系统
- **注册**：用户名 + 密码（3-20字符，密码至少6字符）
- **登录**：持久化会话（JWT，7天有效期）
- **新人奖励**：注册即送 100万 金币

### 2. 每日签到
- 每日可签到一次
- 随机奖励：5万 - 100万 金币
- 签到状态基于当日 0:00 重置

### 3. 押分系统

#### 玩家功能
- 浏览所有进行中和已截止的项目
- 选择选项进行押注（最低 1000 金币）
- 出结果前可继续加注，**不可撤回**
- 查看自己的押注记录
- 查看项目实时押注分布（百分比显示）
- 结算后查看中奖情况

#### 管理员功能
- 创建押分项目
  - 设置项目标题
  - 添加项目描述（可选）
  - 创建多个选项（至少2个）
- 截止押注（状态：进行中 → 已截止）
- 公布正确答案并结算奖池
  - 选择正确选项
  - 系统自动按比例分配奖池
  - 将奖励发放到中奖用户账户

### 4. 奖池计算系统

当前实现：**按比例分配**

#### 计算逻辑
1. 所有押注金额进入总奖池
2. 管理员选择正确答案
3. 押中的玩家按照比例分配奖池：

```
玩家奖励 = 总奖池 × (玩家押注金额 / 正确选项总押注金额)
```

#### 示例
```
项目：期末考试数学冠军
选项A（张三）：10人押注，共 100万 金币
选项B（李四）：5人押注，共 50万 金币
总奖池：150万 金币

正确答案：选项A（张三）

玩家1押注选项A 20万 → 获得：150万 × (20万/100万) = 30万
玩家2押注选项A 30万 → 获得：150万 × (30万/100万) = 45万
...
押注选项B的玩家 → 不获得任何奖励
```

#### 扩展性
系统已预留 `calculationType` 字段，可轻松扩展其他计算方式：
- 固定赔率
- 阶梯奖励
- 保底机制
- 等等...

## 页面结构

### 1. 首页 (`/`)
- 登录/注册入口
- 自动重定向已登录用户到仪表板

### 2. 注册页 (`/register`)
- 用户名输入（3-20字符）
- 密码输入（至少6字符）
- 新人福利提示

### 3. 登录页 (`/login`)
- 用户名输入
- 密码输入

### 4. 用户仪表板 (`/dashboard`)
- **个人信息卡片**
  - 金币余额
  - 参与项目数
  - 签到按钮
- **押分项目列表**
  - 项目状态（进行中/已截止/已结算）
  - 项目信息（创建者、奖池、参与人数）
  - 点击查看详情
- **我的押注记录**
  - 项目名称
  - 押注选项
  - 押注金额
  - 中奖金额
  - 状态

### 5. 项目详情页 (`/project/[id]`)
- **项目信息**
  - 标题、描述
  - 状态标识
  - 总奖池、参与人数
- **选项列表**
  - 选项名称
  - 押注金额和占比
  - 参与人次
  - 进度条可视化
  - 押注表单（项目进行中时）
  - 正确答案标识（已结算时）
- **侧边栏**
  - 我的押注汇总
  - 最近押注动态
- **管理员控制面板**（仅管理员可见）
  - 截止押注按钮
  - 选择正确答案
  - 确认结算按钮

### 6. 创建项目页 (`/admin/create`)
- 仅管理员可访问
- 项目标题输入
- 项目描述输入
- 动态添加/删除选项
- 创建按钮

## 数据库设计

### User（用户表）
```
- id: 用户ID
- username: 用户名（唯一）
- password: 密码（加密存储）
- balance: 金币余额（BigInt，支持大数额）
- isAdmin: 是否为管理员
- lastCheckIn: 上次签到时间
- createdAt: 创建时间
- updatedAt: 更新时间
```

### Project（项目表）
```
- id: 项目ID
- title: 项目标题
- description: 项目描述
- creatorId: 创建者ID
- status: 状态（open/closed/settled）
- calculationType: 计算类型（默认 proportional）
- totalPool: 总奖池（BigInt）
- correctOptionId: 正确答案选项ID
- createdAt: 创建时间
- updatedAt: 更新时间
```

### Option（选项表）
```
- id: 选项ID
- projectId: 所属项目ID
- name: 选项名称
- totalAmount: 该选项总押注金额（BigInt）
- createdAt: 创建时间
```

### Bet（押注表）
```
- id: 押注ID
- userId: 用户ID
- projectId: 项目ID
- optionId: 选项ID
- amount: 押注金额（BigInt）
- reward: 奖励金额（BigInt，结算后填充）
- createdAt: 创建时间
```

## 技术亮点

### 1. 类型安全
- 全面使用 TypeScript
- Prisma ORM 提供端到端类型安全
- 严格的类型检查

### 2. 安全性
- 密码使用 bcrypt 加密
- JWT 会话管理
- HTTP-only cookies
- Server Actions 防止 CSRF

### 3. 性能优化
- Next.js 15 App Router
- Server Components 减少客户端 JavaScript
- 自动代码分割
- 边缘函数支持（Vercel）

### 4. 用户体验
- 响应式设计，支持移动端
- 实时数据更新（押注后刷新）
- 清晰的状态指示
- 友好的错误提示

### 5. 可扩展性
- 模块化组件设计
- 可扩展的奖励计算系统
- 数据库索引优化
- 支持大数额金币（BigInt）

## 未来扩展方向

- [ ] 实时推送（WebSocket）
- [ ] 押注历史图表统计
- [ ] 用户排行榜
- [ ] 多种奖励计算方式
- [ ] 项目分类和标签
- [ ] 评论和讨论功能
- [ ] 移动端 App
- [ ] 社交分享功能
